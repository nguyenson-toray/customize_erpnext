<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generate QR Code</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
	background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
	min-height: 100vh;
	display: flex;
	align-items: center;
	justify-content: center;
	padding: 24px;
}

.wrapper {
	background: #fff;
	border-radius: 16px;
	box-shadow: 0 4px 24px rgba(0,0,0,.07);
	display: flex;
	width: 100%;
	max-width: 820px;
	overflow: hidden;
}

/* ---- Left panel: inputs ---- */
.panel-left {
	flex: 1;
	padding: 36px;
	display: flex;
	flex-direction: column;
}

.panel-left h1 {
	font-size: 21px;
	color: #1a1a2e;
	margin-bottom: 24px;
	display: flex;
	align-items: center;
	gap: 10px;
}

.panel-left h1 .icon {
	width: 32px; height: 32px;
	background: #1a5276;
	border-radius: 8px;
	display: flex;
	align-items: center;
	justify-content: center;
}

.panel-left h1 .icon svg { width: 18px; height: 18px; fill: #fff; }

.form-group { margin-bottom: 18px; }

.form-group label {
	display: block;
	font-size: 12px;
	font-weight: 600;
	color: #6c757d;
	text-transform: uppercase;
	letter-spacing: .5px;
	margin-bottom: 6px;
}

textarea {
	width: 100%;
	min-height: 90px;
	padding: 10px 14px;
	border: 1.5px solid #dee2e6;
	border-radius: 8px;
	font-size: 14px;
	resize: vertical;
	font-family: inherit;
	transition: border-color .2s, box-shadow .2s;
}

textarea:focus { outline: none; border-color: #1a5276; box-shadow: 0 0 0 3px rgba(26,82,118,.1); }

.options-row {
	display: flex;
	gap: 14px;
	align-items: flex-end;
}

.options-row .field { flex: 1; }

input[type="number"] {
	width: 100%;
	padding: 9px 14px;
	border: 1.5px solid #dee2e6;
	border-radius: 8px;
	font-size: 14px;
	transition: border-color .2s, box-shadow .2s;
}

input[type="number"]:focus { outline: none; border-color: #1a5276; box-shadow: 0 0 0 3px rgba(26,82,118,.1); }

.toggle-wrap {
	display: flex;
	align-items: flex-end;
	padding-bottom: 4px;
}

.toggle {
	display: flex;
	align-items: center;
	gap: 10px;
	cursor: pointer;
	user-select: none;
	white-space: nowrap;
}

.toggle input { display: none; }

.toggle .switch {
	display: inline-block;
	width: 40px;
	min-width: 40px;
	height: 22px;
	background: #ced4da;
	border-radius: 11px;
	position: relative;
	transition: background .2s;
	flex-shrink: 0;
}

.toggle .text {
	margin-left: 4px;
	font-size: 13px;
	font-weight: 500;
	color: #495057;
}

.toggle .switch::after {
	content: '';
	width: 16px; height: 16px;
	background: #fff;
	border-radius: 50%;
	position: absolute;
	top: 3px; left: 3px;
	transition: transform .2s;
	box-shadow: 0 1px 3px rgba(0,0,0,.2);
}

.toggle input:checked + .switch { background: #1a5276; }
.toggle input:checked + .switch::after { transform: translateX(18px); }


.btn-generate {
	width: 100%;
	margin-top: auto;
	padding: 13px;
	background: #1a5276;
	color: #fff;
	border: none;
	border-radius: 8px;
	font-size: 15px;
	font-weight: 600;
	cursor: pointer;
	transition: background .2s, transform .1s;
	letter-spacing: .3px;
}

.btn-generate:hover { background: #154360; }
.btn-generate:active { transform: scale(.98); }
.btn-generate:disabled { background: #adb5bd; cursor: not-allowed; transform: none; }

/* ---- Right panel: result ---- */
.panel-right {
	width: 360px;
	background: #f8f9fb;
	border-left: 1px solid #eef0f2;
	display: flex;
	flex-direction: column;
	align-items: center;
	justify-content: center;
	padding: 36px;
}

.placeholder {
	text-align: center;
	color: #adb5bd;
}

.placeholder svg { width: 80px; height: 80px; fill: #dee2e6; margin-bottom: 12px; }
.placeholder p { font-size: 13px; }

.result { display: none; text-align: center; width: 100%; }

.result img {
	width: 100%;
	max-width: 280px;
	border-radius: 10px;
	border: 1px solid #e9ecef;
	box-shadow: 0 2px 12px rgba(0,0,0,.06);
}

.btn-download {
	display: inline-block;
	margin-top: 16px;
	padding: 10px 32px;
	background: #27ae60;
	color: #fff;
	border: none;
	border-radius: 8px;
	font-size: 14px;
	font-weight: 600;
	cursor: pointer;
	text-decoration: none;
	transition: background .2s;
}

.btn-download:hover { background: #219a52; color: #fff; }

/* ---- Responsive ---- */
@media (max-width: 700px) {
	.wrapper { flex-direction: column; }
	.panel-right { width: 100%; border-left: none; border-top: 1px solid #eef0f2; min-height: 200px; }
}
</style>
</head>
<body>
<div class="wrapper">

	<!-- Left: Input -->
	<div class="panel-left">
		<h1>
			<span class="icon">
				<svg viewBox="0 0 24 24"><path d="M3 11h2V9H3v2zm0-4h2V3H3v4zm4 12h2v-4H7v4zm0-8h2V9H7v2zm-4 4h2v-4H3v4zm0 4h2v-2H3v2zm4-16h2V3H7v0zm12 12h2v-4h-2v4zm-8-8h2V3h-2v4zm8-2V3h-2v4h2zM7 7h2V3H7v4zm8 4h2V9h-2v2zm4 4h2v-2h-2v2zm0 4h2v-2h-2v2zm-4 0h2v-4h-2v4zm0-12h2V3h-2v4zm-4 12h2v-4h-2v4zm0-8h2V9h-2v2z"/></svg>
			</span>
			QR Code Generator
		</h1>

		<div class="form-group">
			<label for="content">Content</label>
			<textarea id="content" placeholder="Enter text or URL..."></textarea>
		</div>

		<div class="form-group">
			<div class="options-row">
				<div class="field">
					<label for="size">Size (px)</label>
					<input type="number" id="size" value="500" min="100" max="2000" step="50">
				</div>
				<div class="field toggle-wrap">
					<label class="toggle">
						<input type="checkbox" id="logo" checked>
						<span class="switch"></span>
						<span class="text">Logo</span>
					</label>
				</div>
			</div>
		</div>

		<button class="btn-generate" id="btnGenerate" onclick="generate()">Generate</button>
	</div>

	<!-- Right: Result -->
	<div class="panel-right">
		<div class="placeholder" id="placeholder">
			<svg viewBox="0 0 24 24"><path d="M3 11h2V9H3v2zm0-4h2V3H3v4zm4 12h2v-4H7v4zm0-8h2V9H7v2zm-4 4h2v-4H3v4zm0 4h2v-2H3v2zm4-16h2V3H7v0zm12 12h2v-4h-2v4zm-8-8h2V3h-2v4zm8-2V3h-2v4h2zM7 7h2V3H7v4zm8 4h2V9h-2v2zm4 4h2v-2h-2v2zm0 4h2v-2h-2v2zm-4 0h2v-4h-2v4zm0-12h2V3h-2v4zm-4 12h2v-4h-2v4zm0-8h2V9h-2v2z"/></svg>
			<p>QR code will appear here</p>
		</div>
		<div class="result" id="result">
			<img id="qrImage" alt="QR Code">
			<br>
			<a class="btn-download" id="btnDownload" download="qr-code.png">Download</a>
		</div>
	</div>

</div>

<script>
function generate() {
	var content = document.getElementById('content').value.trim();
	if (!content) { alert('Please enter content'); return; }

	var btn = document.getElementById('btnGenerate');
	btn.disabled = true;
	btn.textContent = 'Generating...';

	var size = document.getElementById('size').value || 500;
	var logo = document.getElementById('logo').checked ? 1 : 0;

	var xhr = new XMLHttpRequest();
	xhr.open('POST', '/api/method/customize_erpnext.api.qr_code.generate_qr');
	xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
	xhr.setRequestHeader('Accept', 'application/json');
	xhr.setRequestHeader('X-Frappe-CSRF-Token', '{{ frappe.session.csrf_token }}');

	xhr.onload = function() {
		btn.disabled = false;
		btn.textContent = 'Generate';

		if (xhr.status === 200) {
			var resp = JSON.parse(xhr.responseText);
			var b64 = resp.message;
			var dataUrl = 'data:image/png;base64,' + b64;

			document.getElementById('qrImage').src = dataUrl;
			document.getElementById('btnDownload').href = dataUrl;
			document.getElementById('placeholder').style.display = 'none';
			document.getElementById('result').style.display = 'block';
		} else {
			alert('Error generating QR code');
		}
	};

	xhr.onerror = function() {
		btn.disabled = false;
		btn.textContent = 'Generate';
		alert('Network error');
	};

	var params = 'content=' + encodeURIComponent(content) + '&size=' + size + '&use_logo=' + logo;
	xhr.send(params);
}

document.getElementById('content').addEventListener('keydown', function(e) {
	if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); generate(); }
});
</script>
</body>
</html>
