# Daily Timesheet - H·ªá Th·ªëng Ch·∫•m C√¥ng T·ª± ƒê·ªông

## üÜï **LATEST UPDATES** (Nh·ªØng thay ƒë·ªïi m·ªõi nh·∫•t)

### ‚≠ê **Code Cleanup & Optimization (2025-10-08)**
- ‚úÖ **X√≥a 5 functions tr√πng l·∫∑p**: Lo·∫°i b·ªè `bulk_recalculate()`, `create_from_checkins()`, `create_from_checkins_hybrid()`, `create_from_checkins_smart()`, `create_from_checkins_job()`
- ‚úÖ **Gi·∫£m ~345 lines code**: T·ªëi ∆∞u c·∫•u tr√∫c code (x√≥a 250 lines duplicate functions + 95 lines unused progress dialog)
- ‚úÖ **Consolidated Functions**:
  - **Bulk Create + Recalculate**: `bulk_create_recalculate_timesheet()` ‚Üí `bulk_create_recalculate_hybrid()` (OPTIMIZED with bulk data loading)
  - **Bulk Recalculate Only**: `bulk_recalculate_smart()` ‚Üí `bulk_recalculate_hybrid()`
- ‚úÖ **Stable Performance**: `batch_size=100` (default), max=200 cho stability v√† predictable performance
- ‚úÖ **UI/UX Improvement**: Removed progress tracking, ch·ªâ hi·ªán th√¥ng b√°o khi ho√†n th√†nh ho·∫∑c c√≥ l·ªói
- ‚úÖ **No Breaking Changes**: JS integration intact, t·∫•t c·∫£ functions hi·ªán t·∫°i v·∫´n ho·∫°t ƒë·ªông

### 1. **Lunch Break Overtime**
- ‚úÖ **T√≠nh OT trong gi·ªù ngh·ªâ tr∆∞a**: ƒêi·ªÅu ki·ªán check-in tr∆∞·ªõc ngh·ªâ tr∆∞a + check-out sau ngh·ªâ tr∆∞a + c√≥ ƒëƒÉng k√Ω OT lunch
- ‚úÖ **Logic t√≠nh**: To√†n b·ªô lunch break period v·ªõi ng∆∞·ª°ng t·ªëi thi·ªÉu 15 ph√∫t
- ‚úÖ **H√†m m·ªõi**: `check_lunch_break_ot_registration()` ki·ªÉm tra ƒëƒÉng k√Ω OT lunch

### 2. **Enhanced Overtime Formula**
- **Tr∆∞·ªõc**: `Actual OT = Pre-shift + Post-shift`
- **‚úÖ Sau**: `Actual OT = Pre-shift + Lunch-break + Post-shift`

### 3. **üîÑ Auto Workflow Integration**
- ‚úÖ **Smart Auto-Recalculation**: Khi Shift Registration/Overtime Registration thay ƒë·ªïi ‚Üí T·ª± ƒë·ªông t√≠nh l·∫°i Daily Timesheet
- ‚úÖ **Intelligent Processing**: ‚â§200 records = real-time, >200 records = background processing
- ‚úÖ **Full Lifecycle**: Submit/Cancel/Update after submit ƒë·ªÅu trigger auto-recalc
- ‚úÖ **Progress Tracking**: Notification v√† progress bar cho bulk operations

## üéØ T·ªïng Quan

**Daily Timesheet** t·ª± ƒë·ªông t√≠nh ch·∫•m c√¥ng t·ª´:
- Employee Checkin/Checkout (m√°y ch·∫•m c√¥ng)
- Shift Registration (ƒëƒÉng k√Ω ca) **‚Üê C√≥ Auto-Recalc**
- Overtime Registration (ƒëƒÉng k√Ω tƒÉng ca) **‚Üê C√≥ Auto-Recalc**
- Maternity Tracking (nh√¢n vi√™n n·ªØ)

### Quy T·∫Øc C∆° B·∫£n

| Shift | Gi·ªù L√†m | Ngh·ªâ Tr∆∞a | OT | Maternity |
|-------|---------|-----------|----|---------__|
| **Day** | 8:00-17:00 | 12:00-13:00 | ‚úÖ | ‚úÖ V·ªÅ 16:00 |
| **Canteen** | 7:00-16:00 | 11:00-12:00 | ‚úÖ | ‚úÖ V·ªÅ 15:00 |
| **Shift 1** | 6:00-14:00 | No break | ‚ùå | ‚úÖ V·ªÅ 13:00 |
| **Shift 2** | 14:00-22:00 | No break | ‚ùå | ‚úÖ V·ªÅ 21:00 |

## ‚öôÔ∏è Thu·∫≠t To√°n T√≠nh To√°n

```
1. X√°c ƒë·ªãnh Shift Type (Registration > Group > Default)
2. Check Maternity Benefit (t·ª´ Maternity Tracking)
3. T√≠nh Working Hours = Morning + Afternoon (kh√¥ng bao g·ªìm OT)
4. ‚úÖ T√≠nh Actual OT = Pre-shift + Lunch-break + Post-shift (NEW)
5. L·∫•y Approved OT t·ª´ registrations
6. Final OT = min(Actual, Approved)
7. Overtime Coefficient (1.5/2.0/3.0)
8. Final OT - With Coefficient = Final OT √ó Coefficient
```

### Overtime Coefficient
- **Ng√†y th∆∞·ªùng (T2-T7)**: 1.5
- **Ch·ªß nh·∫≠t**: 2.0
- **Ng√†y l·ªÖ**: 3.0

### Sunday Logic ƒê·∫∑c Bi·ªát
Ch·ªß nh·∫≠t c√≥ logic ri√™ng:
```python
if is_sunday:
    # Chuy·ªÉn Working Hours ‚Üí Actual OT
    actual_ot = working_hours
    working_hours = 0
    status = "Sunday"
    overtime_coefficient = 2.0
```

### Maternity Benefit
ƒê∆∞·ª£c h∆∞·ªüng v·ªÅ s·ªõm 1h m√† v·∫´n t√≠nh ƒë·ªß gi·ªù:
- **Pregnant**: C·∫ßn `apply_pregnant_benefit = 1` trong Maternity Tracking
- **Maternity Leave**: T·ª± ƒë·ªông ƒë∆∞·ª£c h∆∞·ªüng
- **Young Child**: T·ª± ƒë·ªông ƒë∆∞·ª£c h∆∞·ªüng

## üìä K·∫øt Qu·∫£ T√≠nh To√°n

### V√≠ D·ª• Ca Day (8:00-17:00)

| Tr∆∞·ªùng H·ª£p | Check In/Out | Working Hours | Final OT | Coefficient | Final OT - With Coeff |
|-------------|--------------|---------------|----------|-------------|---------------------|
| B√¨nh th∆∞·ªùng | 8:00‚Üí17:00 | 8h | 0h | 1.5 | 0h |
| C√≥ OT | 8:00‚Üí19:00 | 8h | 2h | 1.5 | **3h** |
| Sunday | 8:00‚Üí17:00 | 0h | 8h | 2.0 | **16h** |
| Sunday + OT | 7:00‚Üí18:00 | 0h | 2h | 2.0 | **4h** |
| Maternity | 8:00‚Üí16:00 | **8h** ‚ú® | 0h | 1.5 | 0h |

*‚ú® = Maternity benefit: v·ªÅ s·ªõm 1h m√† v·∫´n t√≠nh ƒë·ªß gi·ªù*

## üîÑ Auto Sync System

### Real-time Hooks
```python
# Employee Checkin hooks
"after_insert": auto_sync_on_checkin_update
"on_update": auto_sync_on_checkin_update
"on_trash": auto_cleanup_on_checkin_delete

# ‚úÖ NEW: Workflow Integration Hooks
# Shift Registration hooks
"on_submit": auto_recalc_on_shift_registration_change
"on_cancel": auto_recalc_on_shift_registration_change
"on_update_after_submit": auto_recalc_on_shift_registration_change

# Overtime Registration hooks
"on_submit": auto_recalc_on_overtime_registration_change
"on_cancel": auto_recalc_on_overtime_registration_change
"on_update_after_submit": auto_recalc_on_overtime_registration_change

# ‚úÖ NEW: Employee Maternity Tracking hooks
"validate": check_maternity_tracking_changes  # So s√°nh old vs new TR∆Ø·ªöC save
"on_update": auto_recalc_on_maternity_tracking_change  # Recalculate SAU save
```

### Scheduled Job
- **21:00 h√†ng ng√†y**: T·ª± ƒë·ªông sync v√† calculate t·∫•t c·∫£ Daily Timesheet
- T·∫°o records cho employees c√≥ checkin nh∆∞ng ch∆∞a c√≥ timesheet
- Update t·∫•t c·∫£ existing records

### Cleanup Logic
Khi x√≥a Employee Checkin:
- **N·∫øu kh√¥ng c√≤n checkin n√†o kh√°c trong ng√†y** ‚Üí X√≥a Daily Timesheet
- **N·∫øu c√≤n checkin kh√°c** ‚Üí Ch·ªâ update l·∫°i Daily Timesheet

## üìà Daily Timesheet Report

### üéØ Hi·ªÉn Th·ªã T·∫§T C·∫¢ Employees
**Report s·∫Ω hi·ªÉn th·ªã T·∫§T C·∫¢ employees ƒëang active trong period ƒë∆∞·ª£c ch·ªçn:**
- ‚úÖ **Employees c√≥ checkin**: Hi·ªÉn th·ªã v·ªõi d·ªØ li·ªáu th·∫≠t
- ‚úÖ **Employees KH√îNG c√≥ checkin**: Hi·ªÉn th·ªã v·ªõi gi√° tr·ªã 0
- ‚úÖ **Period validation**: Ch·ªâ employees active trong period (d·ª±a v√†o joining/relieving date)

### C·ªôt Hi·ªÉn Th·ªã
**Lu√¥n hi·ªán**: Employee, Employee Name, Group, Check In/Out (HH:MM:SS), Working Hours, Actual OT, Registered OT, Final OT, Status

**Detail Columns** (ch·ªâ khi checked):
- Department, Section
- **Overtime Coefficient, Final OT - With Coefficient**
- Late Entry, Early Exit, Maternity Benefit
- Date of Joining, Relieving Date

### Filter Options
- **Date**: Single Date / Date Range / Monthly
- Department, Section, Group, Employee, Status
- **Summary Mode**: Group by employee
- **Detail Columns**: Show/hide extra columns

## üóÉÔ∏è Database Fields

```json
{
  "employee": "Link to Employee",
  "attendance_date": "Date",
  "check_in": "Datetime",
  "check_out": "Datetime",
  "working_hours": "Float (kh√¥ng bao g·ªìm overtime)",
  "actual_overtime": "Float",
  "approved_overtime": "Float", 
  "overtime_hours": "Float (= min(actual, approved))",
  "overtime_coefficient": "Float (1.5/2.0/3.0)",
  "final_ot_with_coefficient": "Float (Final OT √ó Coefficient)",
  "late_entry": "Check",
  "early_exit": "Check",
  "maternity_benefit": "Check",
  "status": "Select"
}
```

## üöÄ Implementation Status: ‚úÖ HO√ÄN TH√ÄNH

### ‚úÖ Core Features
- Real-time sync t·ª´ Employee Checkin
- Auto calculation v·ªõi maternity benefit
- Sunday logic ƒë·∫∑c bi·ªát
- Overtime coefficient system
- Intelligent cleanup khi x√≥a checkin

### ‚úÖ Report Features  
- Multiple chart types
- Advanced filtering
- Detail Columns control
- HH:MM:SS time format
- Overtime coefficient columns

### ‚úÖ Auto Sync
- Real-time hooks (create/update/delete)
- Daily scheduled job (21:00)
- Error handling & logging
- No duplicates, safe re-run

---

## üìù Quick Commands

```bash
# Sau khi s·ª≠a hooks, ch·∫°y:
bench --site erp-sonnt.tiqn.local clear-cache
bench build
bench --site erp-sonnt.tiqn.local migrate
bench restart

# Manual bulk sync (DEPRECATED - Use bulk_create_recalculate_timesheet instead):
bench --site erp-sonnt.tiqn.local execute "customize_erpnext.customize_erpnext.doctype.daily_timesheet.scheduler.manual_bulk_sync" --kwargs "{'from_date': '2025-01-01', 'to_date': '2025-01-31'}"
```

## üîß Bulk Operations API

### ‚úÖ **Recommended Functions** (After Cleanup)

#### 1. **Bulk Create + Recalculate** (Combined Operation - OPTIMIZED)
```python
# T·∫°o m·ªõi + T√≠nh l·∫°i t·∫•t c·∫£ Daily Timesheet
frappe.call({
    method: "customize_erpnext.customize_erpnext.doctype.daily_timesheet.daily_timesheet.bulk_create_recalculate_timesheet",
    args: {
        from_date: "2025-01-01",
        to_date: "2025-01-31",
        employee: null,     // optional
        batch_size: 100     // Stable batch size (default 100, max 200)
    }
})
```

**Optimization Architecture**:
- ‚úÖ Bulk data loading (single query) for all employees and date range
- ‚úÖ Batch processing with configurable size (default 100, max 200)
- ‚úÖ Transaction commit per batch for data consistency
- ‚úÖ Background job for operations >500 records (auto-detect)
- ‚úÖ Error handling with rollback per batch

#### 2. **Bulk Recalculate Only** (Existing Records)
```python
# Ch·ªâ t√≠nh l·∫°i c√°c Daily Timesheet ƒë√£ t·ªìn t·∫°i
frappe.call({
    method: "customize_erpnext.customize_erpnext.doctype.daily_timesheet.daily_timesheet.bulk_recalculate_smart",
    args: {
        employee: null,  // optional
        date_range: JSON.stringify({
            from_date: "2025-01-01",
            to_date: "2025-01-31"
        }),
        batch_size: 100
    }
})
```

#### 3. **Single Record Recalculate**
```python
# T√≠nh l·∫°i 1 Daily Timesheet record
frappe.call({
    method: "customize_erpnext.customize_erpnext.doctype.daily_timesheet.daily_timesheet.recalculate_timesheet",
    args: {
        docname: "DT-00001"
    }
})
```

### ‚ùå **Deprecated Functions** (Removed in 2025-10-08)
- `bulk_recalculate()` ‚Üí Use `bulk_recalculate_smart()` instead
- `create_from_checkins()` ‚Üí Use `bulk_create_recalculate_timesheet()` instead
- `create_from_checkins_hybrid()` ‚Üí Use `bulk_create_recalculate_hybrid()` instead
- `create_from_checkins_smart()` ‚Üí Use `bulk_create_recalculate_timesheet()` instead
- `create_from_checkins_job()` ‚Üí Use `bulk_create_recalculate_job()` instead

---

## ‚ö° Performance Optimization

### Batch Size Configuration

**Current Settings (Stable Configuration):**

| Configuration | Default | Max | Server Spec | Notes |
|---------------|---------|-----|-------------|-------|
| Conservative | 50 | 100 | 2-4 CPU, 4-8GB RAM | Small servers |
| **Current** | **100** | **200** | **All servers** | **Balanced stability & performance** ‚úÖ |

### Performance Benchmark

**Sequential Processing (Current Implementation):**
```
Batch 50:  ~200 batches √ó 2s/batch = ~400s (6.7 ph√∫t)
Batch 100: ~100 batches √ó 2s/batch = ~200s (3.3 ph√∫t) ‚Üê Current setting ‚úÖ
Batch 200: ~50 batches √ó 2s/batch = ~100s (1.7 ph√∫t) ‚Üê Max limit
```

**Real-world Performance (16 CPU / 32GB RAM):**
- 6,351 records: ~210s (30 rec/sec)
- 7,942 records: ~260s (31 rec/sec)
- Throughput: **~30 records/sec** (stable)

**Why batch_size=100?**
- ‚úÖ Stable v√† predictable performance
- ‚úÖ D·ªÖ debug khi c√≥ l·ªói
- ‚úÖ Transaction rollback nh·ªè n·∫øu c√≥ l·ªói
- ‚úÖ √çt memory pressure
- ‚úÖ Compatible v·ªõi Frappe's database connection pool

### Current Settings
- ‚úÖ Default batch_size: **100**
- ‚úÖ Maximum batch_size: **200**
- ‚úÖ Background job threshold: **500 operations**
- ‚úÖ Transaction commit: Every batch (for data consistency)
- ‚úÖ Bulk data loading: Single query for all data

## ‚öôÔ∏è Constants & Thresholds (Latest Update)

### Minimum Thresholds
```python
MIN_MINUTES_OT = 15                    # Ng∆∞·ª°ng t·ªëi thi·ªÉu t·ªïng OT
MIN_MINUTES_WORKING_HOURS = 10         # Ng∆∞·ª°ng t·ªëi thi·ªÉu working hours
MIN_MINUTES_PRE_SHIFT_OT = 60          # Ng∆∞·ª°ng t·ªëi thi·ªÉu OT tr∆∞·ªõc ca
MIN_MINUTES_CHECKIN_FILTER = 10        # Filter c√°c l·∫ßn ch·∫•m c√¥ng < 10 ph√∫t
```

### Logic Improvements
- **Multiple Checkin Logic**: S·ªõm nh·∫•t = Check In, Mu·ªôn nh·∫•t = Check Out
- **OT Thresholds**: S·ª≠ d·ª•ng constants thay v√¨ hardcode
- **Special Case**: Check in tr∆∞·ªõc ca + Check out tr∆∞·ªõc ngh·ªâ tr∆∞a ‚Üí Working hours = Check out - B·∫Øt ƒë·∫ßu ca
- **Algorithm Dialog**: Hi·ªÉn th·ªã constants real-time t·ª´ server
- **Employee Checkins HTML**: Th√™m c·ªôt `custom_reason_for_manual_check_in`

## üìä Enhanced UI Features

### Timesheet Algorithm Dialog
- **Button**: "Timesheet Algorithm" trong form
- **Dynamic Constants**: L·∫•y t·ª´ server real-time
- **Section Constants**: Hi·ªÉn th·ªã t·∫•t c·∫£ ng∆∞·ª°ng hi·ªán t·∫°i
- **Comprehensive Guide**: Ca l√†m vi·ªác, working hours, overtime, coefficients

### Employee Check-ins Display
- **4 Columns**: Time, Check-in Record, Device, Manual Reason
- **Manual Reason Styling**: M√†u ƒë·ªè n·∫øu c√≥, x√°m n·∫øu kh√¥ng
- **Responsive Table**: T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh width

## üéâ System Status: **FULLY OPERATIONAL + ENHANCED + WORKFLOW INTEGRATED**

### Core Functions
- ‚úÖ Real-time sync working
- ‚úÖ Daily job running at 21:00
- ‚úÖ Reports v·ªõi overtime coefficient
- ‚úÖ Maternity benefit logic correct
- ‚úÖ Sunday logic implemented
- ‚úÖ Cleanup hooks active
- ‚úÖ **Constants-based thresholds**
- ‚úÖ **Enhanced multiple checkin logic**
- ‚úÖ **Dynamic algorithm dialog**
- ‚úÖ **Manual checkin reason display**

### ‚úÖ NEW: Workflow Integration
- ‚úÖ **Lunch Break Overtime**: T√≠nh OT trong gi·ªù ngh·ªâ tr∆∞a
- ‚úÖ **Smart Auto-Recalculation**: Shift/Overtime Registration changes trigger auto-recalc
- ‚úÖ **Employee Maternity Integration**: Employee maternity tracking changes trigger auto-recalc
- ‚úÖ **Intelligent Processing**: Background processing cho bulk operations
- ‚úÖ **Error Handling**: Workflow errors kh√¥ng block main operations
- ‚úÖ **Progress Tracking**: Real-time notifications cho users

---

## ‚ùì **TR·∫¢ L·ªúI C√ÇU H·ªéI: Workflow c√≥ t·ª± ƒë·ªông t√≠nh to√°n l·∫°i Daily Timesheet kh√¥ng?**

### ‚úÖ **C√ì - HO√ÄN TO√ÄN T·ª∞ ƒê·ªòNG**

#### üîÑ Khi √°p d·ª•ng Workflow cho **Shift Registration**:
- **Submit/Cancel/Update after submit** ‚Üí T·ª± ƒë·ªông recalculate affected Daily Timesheet records
- **Smart Detection**: ‚â§200 records = x·ª≠ l√Ω ngay, >200 records = background processing
- **Comprehensive Coverage**: Bao g·ªìm c·∫£ records b·ªã x√≥a trong qu√° tr√¨nh update

#### üîÑ Khi √°p d·ª•ng Workflow cho **Overtime Registration**:
- **Submit/Cancel/Update after submit** ‚Üí T·ª± ƒë·ªông recalculate affected Daily Timesheet records
- **Immediate Impact**: Thay ƒë·ªïi OT registration ·∫£nh h∆∞·ªüng ngay ƒë·∫øn Actual Overtime calculation
- **‚úÖ Lunch Break OT**: H·ªó tr·ª£ t√≠nh OT trong gi·ªù ngh·ªâ tr∆∞a v·ªõi logic m·ªõi

#### üîÑ Khi thay ƒë·ªïi **Employee Maternity Tracking** (NEW):
- **Update/Insert** ‚Üí T·ª± ƒë·ªông recalculate affected Daily Timesheet records
- **Smart Detection**: Ch·ªâ trigger khi c√≥ thay ƒë·ªïi th·ª±c s·ª± trong maternity tracking data
- **Comprehensive Coverage**: Bao g·ªìm pregnancy period, maternity leave, young child periods
- **Date Range Calculation**: T·ª± ƒë·ªông t√≠nh to√°n c√°c ng√†y b·ªã ·∫£nh h∆∞·ªüng d·ª±a tr√™n maternity periods
- **Background Processing**: LU√îN ch·∫°y ng·∫ßm ƒë·ªÉ kh√¥ng block save operation, user nh·∫≠n notification khi ho√†n th√†nh

##### üìä C√°ch t√≠nh s·ªë l∆∞·ª£ng Daily Timesheet c·∫ßn recalculate:

**Logic**: L·∫•y UNION c·ªßa t·∫•t c·∫£ ng√†y trong OLD v√† NEW date ranges

```python
# Thu th·∫≠p ng√†y t·ª´ NEW maternity tracking (sau khi thay ƒë·ªïi)
for tracking in current_maternity_tracking:
    for date in range(tracking.from_date, tracking.to_date):
        affected_dates.add((employee, date))

# Thu th·∫≠p ng√†y t·ª´ OLD maternity tracking (tr∆∞·ªõc khi thay ƒë·ªïi)
for old_tracking in old_maternity_tracking:
    for date in range(old_tracking.from_date, old_tracking.to_date):
        affected_dates.add((employee, date))

# SET t·ª± ƒë·ªông lo·∫°i b·ªè tr√πng l·∫∑p
total_records = len(affected_dates)
```

**V√≠ d·ª•**:
- OLD: 2025-04-05 ƒë·∫øn 2025-09-24 (173 ng√†y)
- NEW: 2025-04-05 ƒë·∫øn 2025-09-26 (175 ng√†y)
- **UNION**: 2025-04-05 ƒë·∫øn 2025-09-26 = **175 ng√†y**

**T·∫°i sao c·∫ßn UNION c·∫£ OLD v√† NEW?**
- ‚úÖ N·∫øu ch·ªâ t√≠nh NEW: b·ªè s√≥t ng√†y b·ªã X√ìA (c·∫ßn c·∫≠p nh·∫≠t ƒë·ªÉ b·ªè maternity benefit)
- ‚úÖ N·∫øu ch·ªâ t√≠nh OLD: b·ªè s√≥t ng√†y TH√äM M·ªöI (c·∫ßn c·∫≠p nh·∫≠t ƒë·ªÉ th√™m maternity benefit)
- ‚úÖ UNION c·∫£ hai: ƒë·∫£m b·∫£o recalculate T·∫§T C·∫¢ ng√†y c√≥ kh·∫£ nƒÉng b·ªã thay ƒë·ªïi

#### üéØ **ƒê·∫∑c ƒëi·ªÉm c·ªßa h·ªá th·ªëng t·ª± ƒë·ªông**:
1. **‚ö° Performance Optimized**:
   - Shift/Overtime Registration: ‚â§200 records = real-time, >200 = background
   - **Employee Maternity: LU√îN background processing ƒë·ªÉ save nhanh**
2. **üõ°Ô∏è Error Handling**: L·ªói trong recalculation kh√¥ng block workflow ch√≠nh
3. **üë§ User Friendly**:
   - Immediate notification khi start processing
   - Progress tracking cho background jobs
   - Completion notification khi done
4. **üìä Data Consistency**: Batch commit (100 records/batch) ƒë·ªÉ ƒë·∫£m b·∫£o t√≠nh nh·∫•t qu√°n
5. **üéØ Smart Processing**: Ch·ªâ recalculate c√°c Daily Timesheet records ƒë√£ t·ªìn t·∫°i

### ‚ö†Ô∏è **L∆∞u √Ω quan tr·ªçng**:
- Ch·ªâ recalculate c√°c Daily Timesheet records **ƒë√£ t·ªìn t·∫°i**, kh√¥ng t·∫°o m·ªõi records
- Workflow errors s·∫Ω ƒë∆∞·ª£c log nh∆∞ng kh√¥ng block main operation
- Large operations (>200 records) s·∫Ω ƒë∆∞·ª£c process trong background v·ªõi progress tracking

---

## üî• **T·ªîNG K·∫æT: Auto-Recalculation Triggers**

H·ªá th·ªëng Daily Timesheet s·∫Ω **T·ª∞ ƒê·ªòNG** t√≠nh to√°n l·∫°i khi:

1. **‚úÖ Employee Checkin**: Real-time update khi c√≥ checkin/checkout m·ªõi
2. **‚úÖ Shift Registration**: Submit/Cancel/Update workflow changes
3. **‚úÖ Overtime Registration**: Submit/Cancel/Update workflow changes
4. **‚úÖ Employee Maternity Tracking**: Thay ƒë·ªïi trong custom_maternity_tracking table
5. **‚úÖ Scheduled Job**: Daily sync l√∫c 22:45 h√†ng ng√†y

**‚Üí K·∫øt qu·∫£**: Daily Timesheet lu√¥n ƒë∆∞·ª£c update real-time v√† ch√≠nh x√°c v·ªõi m·ªçi thay ƒë·ªïi li√™n quan!